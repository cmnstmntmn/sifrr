/*! Sifrr.Dom v0.0.3 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e())}(this,function(){"use strict";const t=window.document.createElement("template"),e=window.document.createElement("script");var n={TEMPLATE:()=>t.cloneNode(!1),SCRIPT:()=>e.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),STATE_REGEX:/^\$\{this\.state\.([a-zA-Z0-9_$]+)\}$/,HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const r=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1),{TEXT_NODE:o}=n;var i={collect:function(t,e){const n=e.length,o=new Array(n);let i,s=r.currentNode=t;for(let t=0;t<n;t++){for(i=e[t].idx;--i;)s=r.nextNode();o[t]=s}return o},create:function(t,e,n){let i,s,a=[],l=0;for(r.currentNode=t;t;)t.nodeType===o&&""===t.data.trim()?(s=t,t=r.nextNode(t),s.remove()):((i=e(t,n))?(a.push({idx:l+1,ref:i}),l=1):l++,t=r.nextNode(t));return a}};const{TEMPLATE:s}=n;var a=(t,...e)=>{const n=s();if("string"==typeof t);else{if(!Array.isArray(t)||"string"!=typeof t[0])return t instanceof NodeList||Array.isArray(t)&&t[0].nodeType?(Array.from(t).forEach(t=>{n.content.appendChild(t)}),n):t.nodeType&&!t.content?(n.content.appendChild(t),n):t;t=String.raw(t,...e)}return t=t.replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=t,n},l=(t,e,n)=>{!1===n||null==n?t.hasAttribute(e)&&t.removeAttribute(e):"class"===e?t.className=n:"id"===e||"value"===e?t[e]=n:t.getAttribute(e)!==n&&t.setAttribute(e,n)};const{TEXT_NODE:c,COMMENT_NODE:d}=n;function u(t,e,n,r=!1){const o=e.length,i=t.childNodes.length;if(i>o){let e=i;for(;e>o;)t.removeChild(t.lastChild),e--}let s,a=t.firstChild,l=e[0];if(r){for(;a;)s=l.nextSibling,a=h(a,l).nextSibling,l=s;for(;l;)s=l.nextSibling,t.appendChild(l),l=s}else{let r=0;for(;a;)a=h(a,e[r]).nextSibling,r++;for(;r<o;)s=e[r],t.appendChild(s.nodeType?s:n(s)),r++}}function h(t,e){if(!e.nodeType)return t.state=e,t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===c||t.nodeType===d)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);const n=t.attributes,r=e.attributes;for(let e=r.length-1;e>=0;--e)l(t,r[e].name,r[e].value);for(let r=n.length-1;r>=0;--r)e.hasAttribute(n[r].name)||t.removeAttribute(n[r].name);return u(t,e.childNodes,void 0,!0),t}var f={makeEqual:h,makeChildrenEqual:u};const{makeEqual:m}=f;function p(t,e){let n=[],r=[],o=-1,i=new Array(t.length);for(let s=e,a=t.length;s<a;s++){let e=t[s];if(e<0)continue;let a=g(n,e);-1!==a&&(i[s]=r[a]),a===o?(n[++o]=e,r[o]=s):e<n[a+1]&&(n[a+1]=e,r[a+1]=s)}for(let t=r[o];o>=0;t=i[t],o--)n[o]=t;return n}function g(t,e){let n=-1,r=t.length;if(r>0&&t[r-1]<=e)return r-1;for(;r-n>1;){let o=Math.floor((n+r)/2);t[o]>e?r=o:n=o}return n}var E={makeChildrenEqualKeyed:function(t,e,n,r){const o=e.length,i=t.childNodes.length;if(0===i){for(let r=0;r<o;r++)t.appendChild(n(e[r]));return}let s,a,l,c,d=0,u=0,h=!0,f=i-1,g=o-1,E=t.firstChild,w=t.lastChild;t:for(;h;){for(h=!1,a=E.state,l=e[u];a[r]===l[r];){if(m(E,l),d++,E=E.nextSibling,u++,f<d||g<u)break t;a=E.state,l=e[u]}for(a=w.state,l=e[g];a[r]===l[r];){if(m(w,l),f--,s=w,w=w.previousSibling,g--,f<d||g<u)break t;a=w.state,l=e[g]}for(a=w.state,l=e[u];a[r]===l[r];){if(h=!0,m(w,l),c=w.previousSibling,t.insertBefore(w,E),w=c,u++,--f<d||g<u)break t;a=w.state,l=e[u]}for(a=E.state,l=e[g];a[r]===l[r];){if(h=!0,m(E,l),c=E.nextSibling,t.insertBefore(E,w.nextSibling),s=E,w=E.previousSibling,E=c,g--,f<++d||g<u)break t;a=E.state,l=e[g]}}if(g<u){if(d<=f){let e;for(;d<=f;)0===f?t.removeChild(w):(e=w.previousSibling,t.removeChild(w),w=e),f--}return}if(f<d){if(u<=g)for(;u<=g;)c=n(e[u]),t.insertBefore(c,s),w=c,u++;return}const y=new Array(g+1-u),b=new Map,_=new Array(f-d+1),S=[];for(let t=u;t<=g;t++)y[t]=-1,b.set(e[t][r],t);let v=0;for(;d<=f;)b.has(E.state[r])?(y[b.get(E.state[r])]=d,v++):S.push(E),_[d]=E,E=E.nextSibling,d++;for(let e=0;e<S.length;e++)t.removeChild(S[e]);if(0===v){for(let r=u;r<=g;r++)t.insertBefore(n(e[r]),E);return}const T=p(y,u);let x,A=T.length-1;for(let r=g;r>=u;r--)T[A]===r?(s=_[y[r]],m(s,e[r]),A--):(-1===y[r]?x=n(e[r]):(x=_[y[r]],m(x,e[r])),t.insertBefore(x,s),s=x)},longestPositiveIncreasingSubsequence:p};const{OUTER_REGEX:w,STATE_REGEX:y}=n;function b(t){let e;e=t.indexOf("return ")>=0?t:"return "+t;try{return new Function(e)}catch(t){return window.console.log("Error processing binding: `".concat(e,"`")),""}}function _(t,e){try{return"string"==typeof t?t:t.call(e)}catch(n){const r=t.toString();window.console.log("Error evaluating: `".concat(r.slice(r.indexOf("{")+1,r.lastIndexOf("}")),"` for element"),e),window.console.error(n)}}const S={getBindingFxns:t=>{const e=t.split(w),n=e.length,r=[];for(let t=0;t<n;t++)"$"===e[t][0]&&"{"===e[t][1]?r.push(b(e[t].slice(2,-1))):e[t]&&r.push(e[t]);return 1===r.length?r[0]:r},getStringBindingFxn:t=>{const e=t.match(y);return e?e[1]:S.getBindingFxns(t)},evaluateBindings:(t,e)=>"function"==typeof t?_(t,e):t.map(t=>_(t,e)).join(""),evaluate:_,replacer:b};var v=S;const{makeChildrenEqual:T}=f,{makeChildrenEqualKeyed:x}=E,{evaluateBindings:A}=v,{TEMPLATE:C,KEY_ATTR:N}=n;var O=function(t,e,n=Object.keys(t._state||{})){e=e||t.constructor.stateMap;const r=t._refs?t._refs.length:0;for(let o=0;o<r;o++){const r=e[o].ref,i=t._refs[o];if(0===r.type){n.indexOf(r.text)>-1&&i.data!=t._state[r.text]&&(i.data=t._state[r.text]);continue}if(1===r.type){const e=A(r.text,t);i.data!=e&&(i.data=e);continue}if(r.attributes)for(let e in r.attributes)if("events"!==e){let n;n=0===r.attributes[e].type?t._state[r.attributes[e].text]:A(r.attributes[e].text,t),l(i,e,n)}else if(!i._sifrrEventSet){for(let e in r.attributes.events)i[e]=A(r.attributes.events[e],t);i._root=t,i._sifrrEventSet=!0}if(void 0===r.text)continue;const s=A(r.text,t);if(s&&0!==s.length||(i.textContent=""),3===r.type){let t;r.keyed&&(t=i.getAttribute(N))?x(i,s,r.se.sifrrClone.bind(r.se),t):T(i,s,r.se.sifrrClone.bind(r.se))}else{let t,e=!1;if(Array.isArray(s))t=s;else if(s.content&&11===s.content.nodeType)t=s.content.childNodes,e=!0;else if(s.nodeType)t=[s];else if("string"==typeof s){const n=C();n.innerHTML=s.toString(),t=n.content.childNodes,e=!0}else t=Array.prototype.slice.call(s);T(i,t,void 0,e)}}};const{collect:L,create:R}=i;var M=function(t,e=null){if(!(t.nodeType||"string"==typeof t||t[0]&&t[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=a(t);if((t=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&-1!==t.getAttribute("is").indexOf("-"))return t.isSifrr||(window.document.body.appendChild(t),window.document.body.removeChild(t)),t;const r=R(t,X,e),o={get:function(){return this._state},set:function(t){const e=[];for(let n in t)this._state[n]!==t[n]&&e.push(n);this._state!==t&&Object.assign(this._state,t),O(this,r,e)}};return t.sifrrClone=function(n){const i=t.cloneNode(!0);return i._refs=L(i,r),i._state=Object.assign({},e,n),Object.defineProperty(i,"state",o),O(i,r),i},t};const{getBindingFxns:k}=v,{KEY_ATTR:j}=n;var q=(t,e,n)=>{let r;t.type=3,e.hasAttribute("data-sifrr-default-state")&&(r=JSON.parse(e.getAttribute("data-sifrr-default-state"))),t.se=M(e.childNodes,r),t.text=k(e.getAttribute(n)),t.keyed=e.hasAttribute(j),e.textContent="",e.removeAttribute(n)};const{TEXT_NODE:$,COMMENT_NODE:P,ELEMENT_NODE:U,HTML_ATTR:B,REPEAT_ATTR:D}=n,{getBindingFxns:H,getStringBindingFxn:F}=v;var X=function(t,e){if(t.nodeType===$||t.nodeType===P){const n=t.data;if(n.indexOf("${")>-1){const r=F(n.trim());return"string"!=typeof r?{type:1,text:r}:(e&&(t.data=e[r]),{type:0,text:r})}}else if(t.nodeType===U){const n={};if(function(t){return t.hasAttribute&&t.hasAttribute(B)}(t)){const e=t.innerHTML;e.indexOf("${")>-1&&(n.type=2,n.text=H(e.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim())),t.textContent=""}else t.hasAttribute(D)&&q(n,t,D);const r=t.attributes,o=r.length,i={events:{}};for(let n=0;n<o;n++){const o=r[n];if("_"===o.name[0]&&o.value.indexOf("${")>=0)i.events[o.name]=H(o.value);else if(o.value.indexOf("${")>=0){const n=F(o.value);"string"!=typeof n?i[o.name]={type:1,text:n}:(i[o.name]={type:0,text:n},e&&l(t,o.name,e[n]))}}if(0===Object.keys(i.events).length&&delete i.events,Object.keys(i).length>0&&(n.attributes=i),Object.keys(n).length>0)return n}return 0};class K{constructor(t,e){if(!window.fetch)throw Error("Sifrr.Dom.load requires Fetch API to work.");if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t,this.url=e}get html(){if(this._html)return this._html;K.add(this.elementName,this);const t=this;return this._html=window.fetch(this.getUrl("html")).then(t=>t.text()).then(t=>a(t).content).then(e=>(t.template=e.querySelector("template"),e)),this._html}get js(){return this._js?this._js:(K.add(this.elementName,this),this._js=window.fetch(this.getUrl("js")).then(t=>t.text()),this._js)}getUrl(t="js"){return this.url||"".concat(window.Sifrr.Dom.config.baseUrl+"/","elements/").concat(this.elementName.split("-").join("/"),".").concat(t)}executeScripts(t){if(this._executed)throw Error("'".concat(this.elementName,"' element's javascript was already executed"));return this._executed=!0,t?this.js.then(t=>new Function(t+"\n //# sourceURL=".concat(this.getUrl("js"))).call()).catch(t=>(window.console.error(t),window.console.log("JS file for '".concat(this.elementName,"' gave error. Trying to get html file.")),this.executeHTMLScripts())):this.executeHTMLScripts()}executeHTMLScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(e=>{if(!e.src)return new Function(e.text+"\n //# sourceURL=".concat(this.getUrl("html"))).call({currentTempate:t.querySelector("template")});{const t=n.SCRIPT();t.src=e.src,t.type=e.type,window.document.body.appendChild(t)}})})}static add(t,e){K._all[t]=e}static get all(){return K._all}}K._all={};var W=K;const I={},G={capture:!0,passive:!0},Y=t=>e=>{const n=e.composedPath?e.composedPath()[0]:e.target;let r=n;for(;r;){const o=r["_".concat(t)]||(r.hasAttribute?r.getAttribute("_".concat(t)):null);"function"==typeof o?o.call(r._root||window,e,n):"string"==typeof o&&new Function("event","target",o).call(r._root||window,event,n),J(e,t,r,n),r=r.parentNode||r.host}},J=(t,e,n,r)=>{function o(e){e.forEach(e=>e(t,r,n))}for(let t in I[e])("function"==typeof n.matches&&n.matches(t)||9===n.nodeType&&"document"===t)&&o(I[e][t])};var z={all:I,add:t=>{if(I[t])return!1;const e=Y(t);return window.addEventListener(t,e,G),I[t]={},!0},addListener:(t,e,n)=>{if(!I[t])throw Error("You need to call Sifrr.Event.add('".concat(t,"') before using listeners."));const r=I[t][e]||[];return r.indexOf(n)<0&&r.push(n),I[t][e]=r,!0},removeListener:(t,e,n)=>{const r=I[t][e]||[],o=r.indexOf(n);return o>=0&&r.splice(o,1),I[t][e]=r,!0},trigger:(t,e,n)=>{"string"==typeof t&&(t=document.querySelector(t));const r=new CustomEvent(e,Object.assign({bubbles:!0,composed:!0},n));t.dispatchEvent(r)},opts:G,getEventListener:Y};const{collect:Z,create:Q}=i,{trigger:V}=z;var tt=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(W.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp?this._ctemp:(this._ctemp=this.template,this._ctemp&&(this.useShadowRoot&&window.ShadyCSS&&!window.ShadyCSS.nativeShadow&&window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this.stateMap=Q(this._ctemp.content,X,this.defaultState)),this._ctemp)}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const t=this.constructor.ctemp.content.cloneNode(!0);this._refs=Z(t,this.constructor.stateMap),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t)):this.__content=t}}connectedCallback(){this.__content&&(0!==this.childNodes.length&&(this.textContent=""),this.appendChild(this.__content),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,n){"data-sifrr-state"===t&&(this.state=JSON.parse(n)),this.onAttributeChange(t,e,n)}onAttributeChange(){}get state(){return this._state}set state(t){const e=[];for(let n in t)this._state[n]!==t[n]&&e.push(n);this._state!==t&&Object.assign(this._state,t),this.update(e),this.onStateChange()}onStateChange(){}update(t){this.beforeUpdate(),O(this,void 0,t),V(this,"update",{detail:{state:this.state}}),this.onUpdate()}beforeUpdate(){}onUpdate(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t){const e=this.cloneNode(!1);return e._state=t,e}clearState(){const t=Object.keys(this._state);this._state={},this.update(t)}$(t,e=!0){return this.shadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.shadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}}}(window.HTMLElement);let et={elements:{},loadingElements:{},registering:[]};return et.Element=tt,et.twoWayBind=(t=>{const e=t.composedPath?t.composedPath()[0]:t.target;if(!e.hasAttribute("data-sifrr-bind")||null===e._root)return;const n=e.value||e.textContent;let r={};if(!e._root){let t;for(t=e;t&&!t.isSifrr;)t=t.parentNode||t.host;e._root=t||null}r[e.getAttribute("data-sifrr-bind")]=n,e._root&&(e._root.state=r)}),et.Loader=W,et.SimpleElement=M,et.Event=z,et.makeChildrenEqual=f.makeChildrenEqual,et.makeChildrenEqualKeyed=E.makeChildrenEqualKeyed,et.makeEqual=f.makeEqual,et.template=a,et.register=((t,e={})=>{t.useSR=et.config.useShadowRoot;const n=t.elementName;if(n){if(window.customElements.get(n))throw Error("Error creating Element: ".concat(n," - Custom Element with this name is already defined."));if(n.indexOf("-")<1)throw Error("Error creating Element: ".concat(n," - Custom Element name must have one dash '-'"));{let r;r=Array.isArray(e.dependsOn)?Promise.all(e.dependsOn.map(t=>et.load(t))):"string"==typeof e.dependsOn?et.load(e.dependsOn):Promise.resolve(!0),delete e.dependsOn;const o=r.then(()=>window.customElements.define(n,t,e));return et.registering[n]=o,o.then(()=>{et.elements[n]=t,delete et.registering[n]}).catch(t=>{throw Error("Error creating Custom Element: ".concat(n," - ").concat(t.message))})}}throw Error("Error creating Custom Element: No name given.",t)}),et.setup=function(t){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,et.config=Object.assign({baseUrl:"",useShadowRoot:!0,events:[]},t),"string"!=typeof et.config.baseUrl)throw Error("baseUrl should be a string");et.config.events.push("input","change","update"),et.config.events.forEach(t=>et.Event.add(t)),et.Event.addListener("input","document",et.twoWayBind),et.Event.addListener("change","document",et.twoWayBind)},et.load=function(t,{url:e,js:n=!0}={}){if(window.customElements.get(t))return Promise.resolve(window.console.warn("Error loading Element: ".concat(t," - Custom Element with this name is already defined.")));return et.loadingElements[name]=window.customElements.whenDefined(t),new et.Loader(t,e).executeScripts(n).then(()=>et.registering[t]).then(()=>{window.customElements.get(t)||window.console.warn("Executing '".concat(t,"' file didn't register the element.")),delete et.loadingElements[name]})},et.loading=(()=>{const t=[];for(let e in et.loadingElements)t.push(et.loadingElements[e]);return Promise.all(t)}),et});
/*! (c) @aadityataparia */
